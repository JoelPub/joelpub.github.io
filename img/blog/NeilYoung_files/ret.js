var RETUID_COOKIE="__retuid";var RETFSESS_COOKIE="__retfs";var WECHAT_OPENID_COOKIE="__wopenid";var FB_OPENID_COOKIE="__fbopenid";var LINE_OPENID_COOKIE="__lopenid";var MEMBER_SYNC_COOKIE="__syncMember";var ICEM_MEMBERID_COOKIE="__icemMemberId";var ICEM_AUTH_SESSION="__icemSession";var TRY_LINE_AUTH_COOKIE="tryLineAuth";var TRY_WECHAT_AUTH_COOKIE="tryWechatAuth";var AUTH_INFO_COOKIE="authInfo";var DEFAULT_TRY_AUTH_COOKIE_MINUTES=0;var PARAM_RET_CLICK_LABEL="clkLabel";var PARAM_RET_TYPE="retType";var PARAM_RET_CERT="retCrt";var PARAM_REC_ITEM_ID="recItemId";var PARAM_REC_DOM_ID="recDomId";var PARAM_REC_RULE_ID="recommendId";var PARAM_ITEM_ID="vItemId";var PARAM_WECHAT_ID="wechatId";var PARAM_SESSION_ID="sessionId";var PARAM_OUTSIDE_SRC="fromOutLink";var PARAM_SHOPPING_DETAIL="shopDetail";var PARAM_CART_DETAIL="cartDetail";var PARAM_APP_NAME="app";var PARAM_CUSTOM_FIELD="ext";var PARAM_SITE_MEMBER="siteMember";var PARAM_FROM="from";var FROM_CONTAINER_TAG="ct";var PARAM_VERSION="v";var previousUrl="";var RET_TYPE_TRACK="track";var RET_TYPE_RET_IMPRESSION="retImpr";var RET_TYPE_RET_CLICK="retClk";var RET_TYPE_BUY="buy";var RET_TYPE_CART="cart";var RET_TYPE_SITE_CLICK="siteClk";var RET_TYPE_SITE_CLICK_IMPRESSION="siteClkImpr";var MARK_CLICK_FROM_RET="recMark=2";var MARK_CLICK_FROM_SITE="recMark=1";var VERSION_CONTAINER_TAG="3.12.8.5";var SRV_HTML_PATH="srv.html?"+VERSION_CONTAINER_TAG;var CRX_RETUID_RETFSESS="retuid-and-retfs";var CRX_RETFSESS="retfs";var CRX_MEMBER_ID=PARAM_SITE_MEMBER;var RET_CUR_PATH="retp";var IN_RET_CLUB=false;var RET=RET||{};if(!String.prototype.startsWith){String.prototype.startsWith=function(b,a){a=a||0;return this.indexOf(b,a)===a}}Number.isInteger=Number.isInteger||function(a){return typeof a==="number"&&isFinite(a)&&Math.floor(a)===a};if(typeof String.prototype.trim!=="function"){String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}}if(typeof(console)=="undefined"){console={};console.log=function(){}}if(!Object.keys){Object.keys=function(c){var b=[];for(var a in c){if(c.hasOwnProperty(a)){b.push(a)}}return b}}if(!document.querySelectorAll){document.querySelectorAll=function(b){var c=document.createElement("style"),d=[],a;document.documentElement.firstChild.appendChild(c);document._qsa=[];c.styleSheet.cssText=b+"{x-qsa:expression(document._qsa && document._qsa.push(this))}";window.scrollBy(0,0);c.parentNode.removeChild(c);while(document._qsa.length){a=document._qsa.shift();a.style.removeAttribute("x-qsa");d.push(a)}document._qsa=null;return d}}RET.loadJS=new function(){var a=this;var b="";return{init:function(){},loadScripts:function(c,e){var d=function(i){var f,g;if(window.XDomainRequest){f=new XDomainRequest()}else{if(window.XMLHttpRequest){f=new XMLHttpRequest()}else{try{f=new ActiveXObject("Microsoft.XMLHTTP")}catch(h){return}}}f.onload=function(){var j=document.createElement("script");j.type="text/javascript";j.text=f.responseText;document.getElementsByTagName("head")[0].appendChild(j);document.head.removeChild(j);g=c.shift();if(g){d(g)}else{if(typeof e==="function"){e()}}};f.open("GET",retUrlPrefix+i,true);f.send()};d(c.shift())},mainProcess:function(){var p=365;MAIN_PROCESS=this;this._retUid=RET.cookieObj.getLocalCookie(RETUID_COOKIE);this.m_extra_param={};this.m_extra_param_q={};console.log("ret.js: mainProcess: get local cookie "+this._retUid);var e=function(){var w=window.location.href;if(w.indexOf(MARK_CLICK_FROM_SITE)>0){return RET_TYPE_SITE_CLICK}else{if(w.indexOf(MARK_CLICK_FROM_RET)>0){return RET_TYPE_RET_CLICK}else{if(typeof retOrderList!="undefined"){return RET_TYPE_BUY}else{if(typeof retCartList!="undefined"){return RET_TYPE_CART}else{return RET_TYPE_TRACK}}}}};var o=function(){if(typeof retApp=="undefined"){return"WEB"}else{return retApp}};var l={};var n=[false,false,false,false];var d=RET.utils.getDocHeight();var m=[];var s=null;var q=null;var f=function(y){if(IN_RET_CLUB){RET.wechat.init(retchatAccount,clubId,appid,y,mid);RET.Fb.init(retchatAccount,clubId,appid,y,mid);RET.line.init(retchatAccount,clubId,appid,y,mid)}MAIN_PROCESS.m_extra_param[PARAM_APP_NAME]=o();RET.cookieObj.getExtraCookieByRet(l.fetchCookieList,MAIN_PROCESS.m_extra_param);var B=RET.utils.getParameterByName("retpid",window.location.href);c(y,B,RET.utils.getParameterByName("catclk",window.location.href));previousUrl=window.location.href;u(y);v(y);if(l.depthScroll==="ON"){i(y)}RET.utils.getUrlParamOrPath(l.urlFetchMap,window.location.href,MAIN_PROCESS.m_extra_param_q);var z=function(){if(!IN_RET_CLUB){if(l.tagRecommendStatus=="ON"||l.domRecList.length>0){return true}}return false};var w=function(){if(IN_RET_CLUB&&typeof retClubRecommendID!="undefined"&&!Number.isInteger(parseInt(retClubRecommendID))){return true}else{return false}};if(w()||z()){RET.queryObj.init(RET.utils.extractRootUrl(retUrlPrefix),y);RET.cookieObj.getExtraCookieByRet(l.fetchCookieList,MAIN_PROCESS.m_extra_param_q);MAIN_PROCESS.m_extra_param_q.siteId=retSiteId;MAIN_PROCESS.m_extra_param_q[PARAM_APP_NAME]=o();MAIN_PROCESS.m_extra_param_q.domIdListStr=RET.utils.getExistDomIdStr(l.domRecList);MAIN_PROCESS.m_extra_param_q.tagRecId=l.tagRecId;RET.fSess.update(MAIN_PROCESS.m_extra_param_q,l.outlinkFilter);RET.queryObj.query(MAIN_PROCESS.m_extra_param_q)}else{if(typeof retClubRecommendID!="undefined"&&Number.isInteger(parseInt(retClubRecommendID))){RET.queryObj.init(RET.utils.extractRootUrl(retUrlPrefix),y);RET.cookieObj.getExtraCookieByRet(l.fetchCookieList,MAIN_PROCESS.m_extra_param_q);MAIN_PROCESS.m_extra_param_q.siteId=retSiteId;MAIN_PROCESS.m_extra_param_q.recommendId=retClubRecommendID;RET.fSess.update(MAIN_PROCESS.m_extra_param_q,l.outlinkFilter);RET.queryObj.query(MAIN_PROCESS.m_extra_param_q)}}if(l.resTagPixelList.length>0){RET.fSess.update(MAIN_PROCESS.m_extra_param,l.outlinkFilter);var x=RET.utils.getExtByUrlParam(l.urlFetchMap,window.location.href);RET.tagPixel.init(l.resTagPixelList,l.outlinkFilter,y,MAIN_PROCESS.m_extra_param[PARAM_SESSION_ID],MAIN_PROCESS.m_extra_param[PARAM_APP_NAME],MAIN_PROCESS.m_extra_param[PARAM_SITE_MEMBER],x);RET.tagPixel.exec()}var A={};RET.cookieObj.getExtraCookieByRet(l.fetchCookieList,A);RET.sync.siteMember(y,retSiteId,A,retUrlPrefix);if(l.tagExternalList.length>0){RET.tagExternal.init(l.tagExternalList);RET.tagExternal.exec()}h()};function c(y,A,x){if(l.tagTrackStatus=="ON"||IN_RET_CLUB){RET.eventObj.init(retUrlPrefix,window.location.href,y);MAIN_PROCESS.m_extra_param.siteId=retSiteId;MAIN_PROCESS.m_extra_param[PARAM_RET_TYPE]=e();delete MAIN_PROCESS.m_extra_param[PARAM_RET_CLICK_LABEL];if(e()==RET_TYPE_TRACK){delete MAIN_PROCESS.m_extra_param[PARAM_ITEM_ID]}if(x&&A!=y){MAIN_PROCESS.m_extra_param.catclk=x;MAIN_PROCESS.m_extra_param.retPid=A}else{delete MAIN_PROCESS.m_extra_param.catclk;delete MAIN_PROCESS.m_extra_param.retPid}if(l.urlFetchMap!=null){var z=RET.utils.getExtByUrlParam(l.urlFetchMap,window.location.href);if(z!=null){var w=JSON.stringify(z);MAIN_PROCESS.m_extra_param[PARAM_CUSTOM_FIELD]=encodeURIComponent(w)}}if(e()==RET_TYPE_BUY){MAIN_PROCESS.m_extra_param[PARAM_SHOPPING_DETAIL]=RET.utils.prepareShoppingList(retOrderList)}else{if(e()==RET_TYPE_CART){MAIN_PROCESS.m_extra_param[PARAM_CART_DETAIL]=RET.utils.prepareShoppingList(retCartList)}else{if(e()!=RET_TYPE_TRACK){}}}RET.fSess.update(MAIN_PROCESS.m_extra_param,l.outlinkFilter);RET.eventObj.submit(MAIN_PROCESS.m_extra_param)}}function u(w){var y=RET.utils.getBrowserVersion();if((y.name=="MSIE"&&y.version<=9)){}else{if(window.history.pushState){var x=window.history.pushState;window.history.pushState=function(){x.apply(window.history,arguments);var z=window.location.href;if(previousUrl!==z){c(w,null,null);previousUrl=z}}}if(window.history.replaceState){s=window.history.replaceState;window.history.replaceState=function(){s.apply(window.history,arguments);var z=window.location.href;if(previousUrl!==z){c(w,null,null);previousUrl=z}};q=window.history.replaceState}}}function v(w){if(window.location.href.indexOf("#")!=-1){var x=location.hash.substring(1);t(l.resTagPixelList,x)}if(("onhashchange" in window)===true){window.onhashchange=function(){var y=location.hash.substring(1);if(m.indexOf(y)!=-1){return}t(l.resTagPixelList,y)}}}function t(B,A){if(B.length>0){for(var y=0;y<B.length;y++){if(B[y].status==="ON"){var z=B[y].triggerList;for(var x=0;x<z.length;x++){for(var w=0;w<z[x].urlRegexList.length;w++){if(A.match(z[x].urlRegexList[w].key)){RET.tagPixel.execPixelEvent(B[y].htmlCodeTrack);m.push(A);return}}}}}}}function i(w){if(("onscroll" in window)){window.onscroll=function(){r(w)}}}function r(z){var x=window.innerHeight;var w=window.scrollY;for(var y=0;y<n.length;y++){if(!n[y]&&(x+w)*4>=d*(y+1)){if(s!=null&&q!=null){RET.eventObj.scrollDepthAction(MAIN_PROCESS.m_extra_param,25*(y+1),s,q)}else{RET.eventObj.scrollDepthAction(MAIN_PROCESS.m_extra_param,25*(y+1),window.history.replaceState,window.history.replaceState)}n[y]=true}}}function h(){if(!RET.tracking||!RET.tracking.q){console.log("Old version of snippet code. Can't use RET.tracking api.");return}console.log("On init ret success, ready to api process, queue:",RET.tracking.q);RET.tracking.q.push=function(w){k(w)};while(RET.tracking.q.length>0){k(RET.tracking.q.shift())}}function k(w){w=Array.prototype.slice.call(w);var x=w.shift();if(RET.api[x]){RET.api[x].apply(this,w)}}var j=function(){var y=CrxDomainStorage;var w=y.init(retUrlPrefix,SRV_HTML_PATH+(new Date().getDate()));if(w){console.log("ret.js: Going to use crxDomain");y.requestValue(CRX_RETUID_RETFSESS+"::"+retSiteId,function(A,C){var F=JSON.parse(C);var E=RET.utils.getBrowserVersion();console.log("browser info: "+JSON.stringify(E));var B=RET.cookieObj.getLocalCookie(RETUID_COOKIE);if((E.name=="Safari"&&E.version>=13)&&B){console.log("retuid inside Safari: "+B);f(B)}else{var z=F.retUid;var D=F.sessionId;console.log("ret.js: get cookie from crxDomain: "+C);RET.cookieObj.setLocalCookie(RETUID_COOKIE,z,p);RET.fSess.setFess(D);f(z)}})}else{console.log("Browser does not support localStorage, create erUid on local domain");var x="RETJS-"+RET.cookieObj.generateLocalRetUid();RET.cookieObj.setLocalCookie(RETUID_COOKIE,x,p);f(x)}};var g=RET.utils.extractRootUrl(retUrlPrefix)+"agent/tagManager/getTagInfo/"+retSiteId;RET.utils.httpClient(g,true,function(w){try{l=JSON.parse(w).data}catch(x){console.log("siteResponse is not JSON string");console.log(x)}j()})}}};(function(){if(typeof retchatAccount!="undefined"&&typeof clubId!="undefined"&&typeof appid!="undefined"){IN_RET_CLUB=true}RET.loadJS.init();var a=["containerTag.js?v="+VERSION_CONTAINER_TAG];RET.loadJS.loadScripts(a,RET.loadJS.mainProcess)})();
